<<<<<<< HEAD
local x,y = display.contentCenterX, display.contentCenterY
local o = display.newRect( x, y, display.contentWidth, display.contentHeight )
o.fill = { type="image", filename="Backgrounds\\Lv1 (Sleepin' Steve).png" }
--
--Util variables
local physics = require("physics")
physics.start()
=======
require ("baseClass")
>>>>>>> 556bacd3800244ce963bec6613186aeb97446b58

lifes = 1
level = 2
enemyShootAnimation = "Enemy"..level.."_shoot"

<<<<<<< HEAD
local sign
local miss = 0
local counter = 0
local openingWondowForShot = math.random(30, 60)
local closingWindowForShot = openingWondowForShot + 60
=======
background("Backgrounds\\Lv"..level..".png")
>>>>>>> 556bacd3800244ce963bec6613186aeb97446b58

protagonist("BR_idle")
antagonist("Enemy"..level.."_idle")

<<<<<<< HEAD
local antaganist = display.newImage("Sprites\\Enemies\\Sleepin' Steve\\Sleepin' Steve_Idle_F1.png", 540, display.contentCenterY+100, 20, 20)
physics.addBody(antaganist, "static")
antaganist.myName = "antaganist"

--
--Bullets
local bullet

--
--Controls player's shooting and correctness of those
    function shoot(event)
        if (event.phase == "began") then
            if (counter >= openingWondowForShot) and (counter <= closingWindowForShot) and (miss == 0) then
                --Shooting at right time
                bullet = display.newRect(120, display.contentCenterY+100, 20, 5)
                physics.addBody(bullet, "dynamic", {radius = 20, isSensor=true })
                bullet.myName = "bullet"
                transition.to(bullet, {x = 560, time = 300,
                onComplete = function() display.remove( bullet ) end
                })
            else 
                --Miss shot
                print("miss: ".. miss)
                miss = 1;
            end
        end
    end

--
--Controls enemy's shooting and sign    
    function shootEnemy()
        --Sign
        if (counter == openingWondowForShot) then
            display.remove(antaganist)
            antaganist = display.newImage("Sprites\\Enemies\\Sleepin' Steve\\Sleepin' Steve_Shoot_F1.png", 540, display.contentCenterY+100, 20, 20)
            physics.addBody(antaganist, "static", {radius = 20, isSensor=true })
            antaganist.myName = "antaganist"
            sign = display.newImage("Sprites\\Objects\\Fire!!.png", display.contentCenterX, display.contentCenterY)
        end

        if (counter == closingWindowForShot) then
            display.remove(sign)
        end
        
        --Enemy shooting
        if (counter == closingWindowForShot) and (score == 0) then
            display.remove(antaganist)
            antaganist = display.newImage("Sprites\\Enemies\\Sleepin' Steve\\Sleepin' Steve_Shoot_F2.png", 540, display.contentCenterY+100, 20, 20)
            physics.addBody(antaganist, "static", {radius = 20, isSensor=true })
            antaganist.myName = "antaganist"
            local bulletEnemy = display.newRect(540, y + 100, 20, 5)
            physics.addBody(bulletEnemy, "dynamic", {isSensor = true})
            bulletEnemy.gravityScale = 0
            bulletEnemy.myName = "bulletEnemy"
            transition.to(bulletEnemy, {x = -100, time = 525,
            onComplete = function() display.remove(bulletEnemy) end
            })
        end

        counter = counter + 1
    end


Runtime:addEventListener("enterFrame", shootEnemy)
Runtime:addEventListener("touch", shoot)

--
--Collision

local function onLocalCollision(event)
=======
function onLocalCollision(event)
>>>>>>> 556bacd3800244ce963bec6613186aeb97446b58
    if (event.phase == "began") then
        local obj1 = event.object1 
        local obj2 = event.object2 

        print("obj1: " .. obj1.myName)
        print("obj2: " .. obj2.myName)

        --Successfull shot
        if ((obj1.myName == "missile" and obj2.myName == "antagonist") or 
            (obj1.myName == "antagonist" and obj2.myName == "missile"))
        then
<<<<<<< HEAD
            display.remove(antaganist)
            antaganist = display.newImage("Sprites\\Enemies\\Sleepin' Steve\\Sleepin' Steve_Die_F1.png", 540, display.contentCenterY+100, 20, 20)
            --
            --switch to new level
            score = score + 1
=======
            lifes = lifes - 1

            if (lifes == 0)
            then
                score = 1
                display.remove(sign)
                antagonistChange("Enemy"..level.."_die")
            else
                antagonistChange("Enemy"..level.."_"..lifes.."die")
                display.remove(sign)
                counter = 0
            end
>>>>>>> 556bacd3800244ce963bec6613186aeb97446b58
        end

        if ((obj1.myName == "bulletEnemy" and obj2.myName == "protagonist") or 
            (obj1.myName == "protagonist" and obj2.myName == "bulletEnemy"))
        then
            protagonistChange("BR_Die"..level)
            antagonist:toFront()
            miss = 2
        end
    end
end

Runtime:addEventListener("enterFrame", shootEnemy)
Runtime:addEventListener("touch", shoot)
Runtime:addEventListener("collision", onLocalCollision)